<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discord VC Live</title>
<style>
  body { background:#23272A; color:#fff; font-family:'Space Grotesk',sans-serif; padding:40px; }
  h1 { color:#7289DA; margin-bottom:10px; }
  #vc-users { display:flex; flex-wrap:wrap; gap:10px; margin-top:20px; }
  .user { background:#2C2F33; border-radius:12px; padding:10px; display:flex; align-items:center; gap:10px; min-width:180px; animation:fadeIn 0.5s; }
  .user img { border-radius:50%; width:40px; height:40px; }
  #leaderboard { margin-top:40px; width:100%; max-width:400px; }
  #leaderboard h2 { color:#99AAB5; }
  #leaderboard li { background:#2C2F33; margin:5px 0; padding:8px; border-radius:8px; list-style:none; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(-10px);} to{opacity:1;transform:translateY(0);} }
</style>
</head>
<body>
<h1>Discord VC Live</h1>
<div id="vc-users">Loading...</div>

<div id="leaderboard">
  <h2>Leaderboard (Total VC Time)</h2>
  <ul id="lb-list">Loading...</ul>
</div>

<script>
// Replace this with your actual hosted bot URL
const API_URL = "https://discord-vc-api.onrender.com/api/voice";


async function fetchVC() {
  const container = document.getElementById("vc-users");
  const lbList = document.getElementById("lb-list");

  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    const users = Object.values(data).flat();

    // Live VC users
    if(users.length === 0){
      container.innerHTML = "No one is in VC right now.";
    } else {
      container.innerHTML = users.map(u=>{
        const seconds = Math.floor((Date.now()-u.joinedAt)/1000);
        const minutes = Math.floor(seconds/60);
        const displayTime = `${minutes}m ${seconds%60}s`;
        return `<div class="user">
                  <img src="${u.avatar}" alt="${u.name}"/>
                  <div><strong>${u.name}</strong><br/><small>${displayTime}</small></div>
                </div>`;
      }).join('');
    }

    // Leaderboard (total time)
    const leaderboard = users
      .map(u => ({name:u.name, total:u.totalTime + (Date.now()-u.joinedAt)}))
      .sort((a,b)=>b.total-a.total);

    lbList.innerHTML = leaderboard.length === 0 
      ? "<li>No users yet</li>"
      : leaderboard.map(u=>{
          const seconds = Math.floor(u.total/1000);
          const minutes = Math.floor(seconds/60);
          const displayTime = `${minutes}m ${seconds%60}s`;
          return `<li><strong>${u.name}</strong> - ${displayTime}</li>`;
        }).join('');

  } catch(e) {
    container.innerHTML = "Error fetching API.";
    lbList.innerHTML = "Error fetching API.";
    console.error(e);
  }
}

fetchVC();
setInterval(fetchVC, 5000);
</script>
</body>
</html>
